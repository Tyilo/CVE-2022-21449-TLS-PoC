#!/bin/bash
set -euo pipefail

docker run --rm -i -v $PWD:/workdir -w /workdir golang:stretch bash -s <<"EOF"
INITPWD=$(pwd)
if [ ! -f go/bin/go ]; then
	cd go/src && ./make.bash
	cd "$INITPWD"
fi


if [ ! -f bin/go-server-test ]; then
	"$INITPWD"/go/bin/go build "$INITPWD"/go-server-test/main.go
	mv main "$INITPWD/bin/go-server-test"
fi
EOF

docker run --rm -i -v $PWD:/workdir -w /workdir maven:3.8-eclipse-temurin-11 bash -s <<"EOF"
INITPWD=$(pwd)
if [ ! -f bin/vulnclient.jar ]; then
	cd "$INITPWD/vulnclient"
	mvn package
	cp target/vulnclient.jar "$INITPWD/bin/"
fi
EOF
